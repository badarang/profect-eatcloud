// 코드 테이블 (Admin CRUD 가능)
Table role_codes {
  code         varchar(30)   [pk]
  display_name varchar(50)   [not null]
  sort_order   integer       [not null]
  is_active    boolean       [not null, default: true]
  p_time_id    uuid          [not null]
}

Table order_status_codes {
  code         varchar(30)   [pk]
  display_name varchar(50)   [not null]
  sort_order   integer       [not null]
  is_active    boolean       [not null, default: true]
  p_time_id    uuid          [not null]
}

Table order_type_codes {
  code         varchar(30)   [pk]
  display_name varchar(50)   [not null]
  sort_order   integer       [not null]
  is_active    boolean       [not null, default: true]
  p_time_id    uuid          [not null]
}

Table payment_status_codes {
  code         varchar(30)   [pk]
  display_name varchar(50)   [not null]
  sort_order   integer       [not null]
  is_active    boolean       [not null, default: true]
  p_time_id    uuid          [not null]
}

Table payment_method_codes {
  code         varchar(30)   [pk]
  display_name varchar(50)   [not null]
  sort_order   integer       [not null]
  is_active    boolean       [not null, default: true]
  p_time_id    uuid          [not null]
}

// 공통 감사(audit) 정보 테이블
Table p_time {
  p_time_id   uuid        [pk]
  created_at  timestamp   [not null, default: `now()`]
  created_by  varchar(100) [not null]
  updated_at  timestamp   [not null, default: `now()`]
  updated_by  varchar(100) [not null]
  deleted_at  timestamp
  deleted_by  varchar(100)
}

// 사용자 관련 테이블
Table p_users {
  id         uuid         [pk]
  username   varchar(18)  [unique, not null]
  nickname   varchar(100)
  email      varchar(255)
  password   varchar(255) [not null]
  role_code  varchar(30)  [not null]
  phone_number varchar(18)
  points     Integer
  p_time_id  uuid         [not null]
}

// 주소 테이블
Table p_addresses {
  id           uuid         [pk]
  userid       varchar(10)  [not null]
  zipcode      varchar(10)
  road_addr    varchar(500)
  detail_addr  varchar(200)
  is_selected  boolean
  p_time_id    uuid         [not null]
}

// 카테고리 테이블 (관리자 CRUD)
Table p_categories {
  category_id   uuid        [pk]
  category_name varchar(100) [not null]
  sort_order    integer     [not null]
  is_active     boolean     [not null, default: true]
  p_time_id     uuid        [not null]
}

// 배달 가능 지역 테이블
Table delivery_areas {
  area_id     uuid         [pk]
  area_name   varchar(100) [not null]
  p_time_id   uuid         [not null]
}

// 매장↔배달 가능 지역 매핑 테이블
Table p_store_delivery_areas {
  store_id    uuid         [not null]
  area_id     uuid         [not null]
  p_time_id   uuid         [not null]
  delivery_fee  int [not null, default : 0]
}

// 매장 테이블
Table p_stores {
  store_id         uuid         [pk]
  store_name       varchar(200) [not null]
  store_address    varchar(500)
  phone_number     varchar(18)
  category_id      uuid
  min_cost         int          [not null, default: 0]
  discription      text
  store_lat        double
  store_lon        double
  open_status      boolean
  open_time        time         [not null, note: "운영 시작 시간"]
  close_time       time         [not null, note: "운영 종료 시간"]
  p_time_id        uuid         [not null]
}

Table p_menu_category {
  code         varchar(30)   [pk]
  display_name varchar(50)   [not null]
  sort_order   integer       [not null]
  is_active    boolean       [not null, default: true]
  p_time_id    uuid          [not null]
}

// 메뉴 테이블
Table p_menus {
  menu_id      uuid          [pk]
  store_id     uuid          [not null]
  menu_num     int           [not null]
  menu_name    varchar(200)  [not null]
  menu_category_code varchar(30)  [not null]
  price        decimal(10,2) [not null]
  description  text
  is_available    boolean       [not null, default: true, note: "판매 가능 여부"]
  image_url     varchar(500)
  p_time_id    uuid          [not null]
}

// 장바구니 테이블 (사용자당 1개)
Table p_cart {
  cart_id    uuid      [pk]
  user_id    varchar(10) [not null]
  cart_items jsonb     [not null]
  p_time_id  uuid      [not null]
}

Table p_payment_requests {
  payment_request_id uuid         [pk]
  order_id           uuid         [not null]
  pg_provider        varchar(100) [not null]
  request_payload    jsonb        [not null]
  redirect_url       text
  status             varchar(50)  [not null]
  requested_at       timestamp    [not null]
  responded_at       timestamp
  failure_reason     text
  p_time_id       uuid               [not null]
}

// 결제 테이블 (주문 후 생성, 주문과 1:N 관계)
Table p_payments {
  payment_id           uuid                 [pk]
  user_id              varchar(10)          [not null]
  payment_request_id   uuid                 [not null]
  payment_status       varchar(30)          [not null]
  payment_method       varchar(30)          [not null]
  total_amount         int        [not null]
  pg_transaction_id    varchar(100)
  approval_code        varchar(50)
  card_info            jsonb
  redirect_url         text
  receipt_url          text
  requested_at         timestamp
  approved_at          timestamp
  failed_at            timestamp
  failure_reason       text
  offline_payment_note text
  p_time_id            uuid                 [not null]
}

// 주문 공통 테이블 (매장별 주문)
Table p_orders {
  order_id        uuid               [pk]
  order_number    varchar(50)        [unique, not null]
  user_id         varchar(10)        [not null]
  store_id        uuid               [not null]
  payment_id      uuid               [not null, default: -1]
  order_status    varchar(30)        [not null]
  order_type      varchar(30)        [not null]
  order_menu_list jsonb              [not null]
  p_time_id       uuid               [not null]
}

// 배달 주문 상세
Table p_delivery_orders {
  order_id                   uuid           [pk]
  delivery_fee               decimal(10,2)  [default: 0]
  delivery_requests          text
  zipcode                    varchar(10)
  road_addr                  varchar(500)
  detail_addr                varchar(200)
  estimated_delivery_time    timestamp
  estimated_preparation_time integer
  canceled_at                timestamp
  canceled_by                varchar(100)
  cancel_reason              text
  p_time_id                  uuid           [not null]
}

// 포장 주문 상세
Table p_pickup_orders {
  order_id             uuid    [pk]
  pickup_requests      text
  estimated_pickup_time timestamp
  canceled_at          timestamp
  canceled_by          varchar(100)
  cancel_reason        text
  p_time_id            uuid    [not null]
}

// 리뷰/평점 테이블
Table p_reviews {
  review_id uuid         [pk]
  order_id  uuid         [not null]
  rating    numeric(2,1) [not null]
  content   text         [not null]
  p_time_id uuid         [not null]
}

// AI 응답 테이블
Table p_ai_responses {
  ai_response_id uuid [pk]
  description    text [not null]
  p_time_id      uuid [not null]
}

// 일일 매장 매출/건수 통계
Table daily_store_sales {
  sale_date    date           [pk]
  store_id     uuid           [pk]
  order_count  integer        [not null]
  total_amount decimal(12,2)  [not null]
  p_time_id    uuid           [not null]
}

// 일일 메뉴 판매 수량/매출 통계
Table daily_menu_sales {
  sale_date     date           [pk]
  store_id      uuid           [pk]
  menu_id       uuid           [pk]
  quantity_sold integer        [not null]
  total_amount  decimal(12,2)  [not null]
  p_time_id     uuid           [not null]
}

Ref: "p_users"."role_code"                           > "role_codes"."code"
Ref: "p_addresses"."userid"                          > "p_users"."username"
Ref: "p_stores"."category_id"                        > "p_categories"."category_id"
Ref: "p_menus"."store_id"                            > "p_stores"."store_id"
Ref: "p_cart"."user_id"                              > "p_users"."username"
Ref: "p_payment_requests"."order_id"                 > "p_orders"."order_id"
Ref: "p_payments"."user_id"                          > "p_users"."username"
Ref: "p_payments"."payment_request_id"               > "p_payment_requests"."payment_request_id"
Ref: "p_orders"."user_id"                            > "p_users"."username"
Ref: "p_orders"."store_id"                           > "p_stores"."store_id"
Ref: "p_orders"."payment_id"                         > "p_payments"."payment_request_id"
Ref: "p_delivery_orders"."order_id"                  > "p_orders"."order_id"
Ref: "p_pickup_orders"."order_id"                    > "p_orders"."order_id"
Ref: "p_reviews"."order_id"                          > "p_orders"."order_id"
Ref: "daily_store_sales"."store_id"                  > "p_stores"."store_id"
Ref: "daily_menu_sales"."store_id"                   > "p_stores"."store_id"
Ref: "daily_menu_sales"."menu_id"                    > "p_menus"."menu_id"
Ref: "p_menus"."menu_category_code"                  > "p_menu_category"."code"
Ref: "p_store_delivery_areas"."store_id" > "p_stores"."store_id"
Ref: "p_store_delivery_areas"."area_id"  > "delivery_areas"."area_id"

// 공통 감사(p_time) 관계
Ref: "role_codes"."p_time_id"                        > "p_time"."p_time_id"
Ref: "order_status_codes"."p_time_id"                > "p_time"."p_time_id"
Ref: "order_type_codes"."p_time_id"                  > "p_time"."p_time_id"
Ref: "payment_status_codes"."p_time_id"              > "p_time"."p_time_id"
Ref: "payment_method_codes"."p_time_id"              > "p_time"."p_time_id"
Ref: "p_users"."p_time_id"                           > "p_time"."p_time_id"
Ref: "p_addresses"."p_time_id"                       > "p_time"."p_time_id"
Ref: "p_categories"."p_time_id"                      > "p_time"."p_time_id"
Ref: "p_stores"."p_time_id"                          > "p_time"."p_time_id"
Ref: "p_menus"."p_time_id"                           > "p_time"."p_time_id"
Ref: "p_cart"."p_time_id"                            > "p_time"."p_time_id"
Ref: "p_payment_requests"."p_time_id"                > "p_time"."p_time_id"
Ref: "p_payments"."p_time_id"                        > "p_time"."p_time_id"
Ref: "p_orders"."p_time_id"                          > "p_time"."p_time_id"
Ref: "p_delivery_orders"."p_time_id"                 > "p_time"."p_time_id"
Ref: "p_pickup_orders"."p_time_id"                   > "p_time"."p_time_id"
Ref: "p_reviews"."p_time_id"                         > "p_time"."p_time_id"
Ref: "p_ai_responses"."p_time_id"                    > "p_time"."p_time_id"
Ref: "daily_store_sales"."p_time_id"                 > "p_time"."p_time_id"
Ref: "daily_menu_sales"."p_time_id"                  > "p_time"."p_time_id"